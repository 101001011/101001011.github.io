<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>简单的代数反演 | CCA&#39;s Blog</title>
  <link rel="stylesheet" href="/css/fonts/Chinese-normal-normal.min.css">
  <link rel="stylesheet" href="/css/fonts/ChineseMono-normal-normal.min.css">
  <link rel="stylesheet" href="/css/fonts/Chinese-italic-normal.min.css">
  <link rel="stylesheet" href="/css/fonts/Chinese-normal-bold.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="description" content="各种代数反演技巧汇总">
  
  
  
    <link rel="shortcut icon" href="../../../../favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox-1.3.4.css">
  
  
<meta name="generator" content="Hexo 6.1.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <div id="nav-outer">
  <nav id="main-nav" class="outer">
    <a id="main-nav-toggle" class="nav-icon"></a>
    
      <a class="main-nav-link" href="../../../../index.html">Home</a>
    
      <a class="main-nav-link" href="../../../../archives">Archives</a>
    
      <a class="main-nav-link" href="../../../../about">About</a>
    
    <div class="main-nav-space-between"></div>
    
  </nav>
</div>
<div id="header-title">
  <h1 id="logo-wrap">
    <a href="../../../../index.html" id="logo">CCA&#39;s Blog</a>
  </h1>
  
    <h2 id="subtitle-wrap">
      <a href="../../../../index.html" id="subtitle">智慧. 优雅. 理性.</a>
    </h2>
  
</div>

      <div id="content" class="outer">
        <section id="main"><article id="post-简单的代数反演" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="" class="article-date">
  <time class="dt-published" datetime="2023-06-24T03:00:56.718Z" itemprop="datePublished">2023-06-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../../../../categories/%E7%AE%97%E6%B3%95/">算法</a>►<a class="article-category-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/">组合数学</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      简单的代数反演
    </h1>
  

      </header>
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="二项式反演">二项式反演</h2>
<h3 id="数列形式">数列形式</h3>
<div class="markdown-them-math-block">$$g(x)=\sum_{i=x}^n\dbinom{i}{x}f(i)\iff f(x)=\sum_{i=x}^n (-1)^{i-x}\dbinom{i}{x}g(i)
$$</div><p><span class="markdown-them-math-inline">$\large\rm Proof:$</span></p>
<p>将上式带入下式得 <span class="markdown-them-math-inline">$:$</span></p>
<div class="markdown-them-math-block">$$f(x)=\sum_{i=x}^n (-1)^{i-x}\dbinom{i}{x}\sum_{j=i}^n\dbinom{j}{i}f(j)
$$</div><p>整理得 <span class="markdown-them-math-inline">$:$</span></p>
<div class="markdown-them-math-block">$$f(x)=\sum_{i=x}^n\sum_{j=i}^n(-1)^{i-x}\dbinom{j}{i}\dbinom{i}{x}f(j)
$$</div><p>根据组合恒等式 <span class="markdown-them-math-inline">$\dbinom{i}{j}\dbinom{j}{k}=\dbinom{i}{k}\dbinom{i-k}{j-k}$</span> 得 <span class="markdown-them-math-inline">$:$</span></p>
<div class="markdown-them-math-block">$$f(x)=\sum_{i=x}^n\sum_{j=i}^n(-1)^{i-x}\dbinom{j}{x}\dbinom{j-x}{i-x}f(j)
$$</div><p>交换枚举顺序得 <span class="markdown-them-math-inline">$:$</span></p>
<div class="markdown-them-math-block">$$f(x)=\sum_{j=x}^n\sum_{i=x}^j(-1)^{i-x}\dbinom{j}{x}\dbinom{j-x}{i-x}f(j)
$$</div><p>改变代表字母<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>整理得 <span class="markdown-them-math-inline">$:$</span></p>
<div class="markdown-them-math-block">$$f(x)=\sum_{i=x}^n\dbinom{i}{x}f(i)\sum_{j=x}^i(-1)^{j-x}\dbinom{i-x}{j-x}
$$</div><p>将靠后的 <span class="markdown-them-math-inline">$\sum$</span> 枚举的 <span class="markdown-them-math-inline">$j$</span> 替换成 <span class="markdown-them-math-inline">$j+x$</span> 得  <span class="markdown-them-math-inline">$:$</span></p>
<div class="markdown-them-math-block">$$f(x)=\sum_{i=x}^n\dbinom{i}{x}f(i)\sum_{j=0}^{i-x}(-1)^{j}\dbinom{i-x}{j}
$$</div><div class="markdown-them-math-block">$$\because \sum_{i=0}^k(-1)^i\dbinom{k}{i}=(1-1)^k
$$</div><div class="markdown-them-math-block">$$\therefore \sum_{i=0}^k(-1)^i\dbinom{k}{i}=[k=0]
$$</div><p>所以此式不为 <span class="markdown-them-math-inline">$0$</span> 当且仅当 <span class="markdown-them-math-inline">$i=x$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>故 <span class="markdown-them-math-inline">$:$</span></p>
<div class="markdown-them-math-block">$$f(x)=\sum_{i=x}\dbinom{x}{x}f(i)=f(x)
$$</div><p>原式得证<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><strong>我们来看看二项式反演的数列形式有什么应用<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></strong></p>
<p><strong>乱序排列问题<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></strong> 求有多少种不同的长度为 <span class="markdown-them-math-inline">$n$</span> 的排列 <span class="markdown-them-math-inline">$p$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>使得 <span class="markdown-them-math-inline">$\forall i\in [1,n],p_i\not = i$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>令 <span class="markdown-them-math-inline">$g(i)$</span> 表示钦定有 <span class="markdown-them-math-inline">$i$</span> 个数一定在自己的位置上<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>剩下的随便排的方案数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>显然有 :</p>
<div class="markdown-them-math-block">$$g(i)=\dbinom{n}{i}(n-i)!
$$</div><p>令 <span class="markdown-them-math-inline">$f(i)$</span> 表示恰好有 <span class="markdown-them-math-inline">$i$</span> 个数在自己的位置上的方案数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>考虑到 <span class="markdown-them-math-inline">$f(i)$</span> 会被 <span class="markdown-them-math-inline">$g(j)~(j\leqslant i)$</span> 计算 <span class="markdown-them-math-inline">$\dbinom{i}{j}$</span> 次<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>于是有 <span class="markdown-them-math-inline">$:$</span></p>
<div class="markdown-them-math-block">$$g(i)=\sum_{j=i}^n\dbinom{j}{i}f(j)
$$</div><p>根据二项式反演 <span class="markdown-them-math-inline">$:$</span></p>
<div class="markdown-them-math-block">$$f(i)=\sum_{j=i}^n(-1)^{j-i}\dbinom{j}{i}g(j)
$$</div><p>将 <span class="markdown-them-math-inline">$g(i)=\dbinom{n}{i}(n-i)!$</span> 带入得 <span class="markdown-them-math-inline">$:$</span></p>
<div class="markdown-them-math-block">$$f(i)=\sum_{j=i}^n(-1)^{j-i}\dbinom{j}{i}\dbinom{n}{j}(n-j)!
$$</div><p>根据组合恒等式 <span class="markdown-them-math-inline">$\dbinom{i}{j}\dbinom{j}{k}=\dbinom{i}{k}\dbinom{i-k}{j-k}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>整理得 <span class="markdown-them-math-inline">$:$</span></p>
<div class="markdown-them-math-block">$$f(i)=\dbinom{n}{i}\sum_{j=i}^n(-1)^{j-i}\dbinom{n-i}{j-i}(n-j)!
$$</div><p>考虑到当 <span class="markdown-them-math-inline">$i=0$</span> 时为答案<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>所以 <span class="markdown-them-math-inline">$:$</span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
    Ans=f(0)&amp;=\sum_{i=0}^n(-1)^i\dbinom{n}{i}(n-i)!\\&amp;=\sum_{i=0}^n(-1)^i\dfrac{n!}{i!}\\&amp;=(n+1)!\sum_{i=0}^n(-1)^i(i!)^{-1}
\end{aligned}
$$</div><h3 id="集合形式">集合形式</h3>
<div class="markdown-them-math-block">$$f(S)=\sum_{S\subseteq T}g(T)\iff g(S)=\sum_{S\subseteq T} (-1)^{|T|-|S|}f(T)
$$</div><p><span class="markdown-them-math-inline">$\large\rm Proof:$</span></p>
<p>同样考虑带入证明 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
    f(S)&amp;=\sum_{S\subseteq T}\sum_{T\subseteq R}(-1)^{|R|-|T|}f(R)\\&amp;=\sum_{S\subseteq R}f(R)\sum_{S\subseteq T\subseteq R}(-1)^{|R|-|T|}
\end{aligned}
$$</div><p>考虑枚举 <span class="markdown-them-math-inline">$T-S$</span> 的大小 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
    f(S)&amp;=\sum_{S\subseteq R}f(R)\sum_{i=0}^{|R|-|S|}\dbinom{|R|-|S|}{i}(-1)^{|R|-(|S|+i)}\\&amp;=\sum_{S\subseteq R}[|S|=|R|]\\&amp;=f(S)
\end{aligned}
$$</div><p>原式得证<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><strong>我们来看看二项式反演的集合形式有什么应用<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></strong></p>
<p><strong>有向图无环子图计数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></strong> 给定一张 <span class="markdown-them-math-inline">$n$</span> 个点的有向图<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>求其无环子图的数量<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>考虑动态规划<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>设 <span class="markdown-them-math-inline">$f_S$</span> 表示点集 <span class="markdown-them-math-inline">$S$</span> 导出子图的答案<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>由于是 <span class="markdown-them-math-inline">$\rm DAG$</span> 计数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>所以我们可以很自然地想到枚举入度为 <span class="markdown-them-math-inline">$0$</span> 的点<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>假设 <span class="markdown-them-math-inline">$T$</span> 是 <span class="markdown-them-math-inline">$S$</span> 的子集<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>并且其中的每个点都没有入边<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>那么显然有转移 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$f_S=\sum_{T\subseteq S,T\not = \varnothing}2^{cnt_{T,S-T}}\times f_{S-T}
$$</div><p>其中 <span class="markdown-them-math-inline">$cnt_{S,T}$</span> 表示集合 <span class="markdown-them-math-inline">$S$</span> 到集合 <span class="markdown-them-math-inline">$T$</span> 的连边总数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>但我们发现这样做实际上是错的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>因为 <span class="markdown-them-math-inline">$T$</span> 不一定包含了 <span class="markdown-them-math-inline">$S$</span> 中所有入度为 <span class="markdown-them-math-inline">$0$</span> 的点<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们考虑容斥<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>设 <span class="markdown-them-math-inline">$q_T=2^{cnt_{T,S-T}}\times f_{S-T}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span><span class="markdown-them-math-inline">$p_T$</span> 表示 <span class="markdown-them-math-inline">$S$</span> 中恰好有 <span class="markdown-them-math-inline">$T$</span> 作为入度为 <span class="markdown-them-math-inline">$0$</span> 的点的方案数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>有 <span class="markdown-them-math-inline">$q_T=\sum\limits_{T\subseteq S} p_S$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>由二项式反演的集合形式可以得到 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$p_S=\sum_{S\subseteq T}(-1)^{|T|-|S|}q_T
$$</div><p>回到原本的 <span class="markdown-them-math-inline">$\rm DP$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们需要求 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
    f_S&amp;=\sum_{T\subseteq S,T\not= \varnothing}p_T\\&amp;=\sum_{T\subseteq S,T\not= \varnothing}\sum_{T\subseteq R\subseteq S}(-1)^{|R|-|T|}q_R\\&amp;=\sum_{R\subseteq S,R\not= \varnothing}q_R \sum_{T\subseteq R,T\not=\varnothing}(-1)^{|R|-|T|}\\&amp;=\sum_{R\subseteq S,R\not= \varnothing}q_R (-1)^{|R|}\left(\sum_{T\subseteq R}(-1)^{-|T|}-1\right)\\&amp;=\sum_{T\subseteq S,T\not= \varnothing}(-1)^{|T|-1}q_T
\end{aligned}
$$</div><p>于是转移方程为 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$f_S=\sum_{T\subseteq S,T\not= \varnothing}(-1)^{|T|-1}2^{cnt_{T,S-T}}f_{S-T}
$$</div><p>现在只需要 <span class="markdown-them-math-inline">$\Theta(1)$</span> 计算 <span class="markdown-them-math-inline">$cnt_{T,S-T}$</span> 即可做到 <span class="markdown-them-math-inline">$\Theta(3^n)$</span> 计算计算答案<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>考虑预处理<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>可以在枚举了每个 <span class="markdown-them-math-inline">$S$</span> 做转移的时候再算这个东西<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>此时只需要记 <span class="markdown-them-math-inline">$cnt_T~(T\subseteq S,T\not=\varnothing)$</span> 表示 <span class="markdown-them-math-inline">$T$</span> 恰好作为 <span class="markdown-them-math-inline">$S$</span> 中没有入度的点集的路径数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>考虑在进行所有计算之前预处理 <span class="markdown-them-math-inline">$A_{i,S}$</span> 表示 <span class="markdown-them-math-inline">$i$</span> 到 <span class="markdown-them-math-inline">$S$</span> 中的边数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span><span class="markdown-them-math-inline">$D_{i,S}$</span> 表示 <span class="markdown-them-math-inline">$S$</span> 中的点到 <span class="markdown-them-math-inline">$i$</span> 的边数和<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>这两个数组都可以 <span class="markdown-them-math-inline">$\Theta(n2^n)$</span> 预处理<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>计算 <span class="markdown-them-math-inline">$cnt$</span> 时考虑从小到大枚举每个 <span class="markdown-them-math-inline">$T$</span> 计算答案<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>可以发现 <span class="markdown-them-math-inline">$T$</span> 的每个真子集的答案都已经被计算出来了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>于是任取一个点从 <span class="markdown-them-math-inline">$T$</span> 中移到 <span class="markdown-them-math-inline">$S-T$</span> 即可算出答案<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>这里考虑 <span class="markdown-them-math-inline">$\Theta(1)$</span> 枚举 <code>lowbit</code>. 可以发现<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>转移式为 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$cnt_T=cnt_{T-\{u\}}+A_{u,S-T}-D_{T-\{u\},u}
$$</div><p>于是本题到此<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>可以做到时间复杂度 <span class="markdown-them-math-inline">$\Theta(3^n)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>空间复杂度 <span class="markdown-them-math-inline">$\Theta(n2^n)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h3 id="子集反演">子集反演</h3>
<div class="markdown-them-math-block">$$f(S)=\sum_{T\subseteq S}g(T)\iff g(S)=\sum_{T\subseteq S}(-1)^{|S|-|T|}f(T)
$$</div><p><span class="markdown-them-math-inline">$\large\rm Proof:$</span></p>
<p>还是考虑带入证明<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>与二项式反演的集合形式类似 <span class="markdown-them-math-inline">$:$</span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
    f(S)&amp;=\sum_{T\subseteq S}\sum_{R\subseteq T}(-1)^{|T|-|R|}f(R)\\&amp;=\sum_{R\subseteq S}f(R)\sum_{R\subseteq T\subseteq S}(-1)^{|T|-|R|}\\&amp;=\sum_{R\subseteq S}f(R)\sum_{i=0}^{|S|-|R|}\dbinom{|S|-|R|}{i}(-1)^{(|S|-i)-|R|}\\&amp;=\sum_{R\subseteq S}[|R|=|S|]\\&amp;=f(S)
\end{aligned}
$$</div><p>原式得证<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h2 id="斯特林反演">斯特林反演</h2>
<h3 id="第二类斯特林数">第二类斯特林数</h3>
<h4 id="定义">定义</h4>
<p>定义 <span class="markdown-them-math-inline">$\begin{Bmatrix}n \\ m\end{Bmatrix}$</span> 为将 <span class="markdown-them-math-inline">$n$</span> 个有标号小球放入 <span class="markdown-them-math-inline">$m$</span> 个无标号盒子<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>每个盒子不能为空的方案<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h4 id="递推式">递推式</h4>
<div class="markdown-them-math-block">$$\begin{Bmatrix}n \\ m\end{Bmatrix} = \begin{Bmatrix}n - 1 \\ m - 1\end{Bmatrix} + m \times \begin{Bmatrix}n - 1 \\ m\end{Bmatrix}
$$</div><p>根据组合意义不难证明<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h4 id="求一行第二类斯特林数">求一行第二类斯特林数</h4>
<p>考虑以下第二类斯特林数的组合意义<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们考虑使用容斥描述第二类斯特林数的答案<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>首先我们求出将 <span class="markdown-them-math-inline">$n$</span> 个有标号小球放入 <span class="markdown-them-math-inline">$m$</span> 个有标号盒子<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>盒子不能为空的方案<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>根据这个问题的特殊性<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>任意一种无标号盒子的方案恰好双向对应 <span class="markdown-them-math-inline">$m!$</span> 中有标号盒子的方案<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>最后除 <span class="markdown-them-math-inline">$m!$</span> 即可<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>对于盒子是否为空进行容斥<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{Bmatrix}n \\ m\end{Bmatrix} = \frac{1}{m!} \sum\limits_i ^ m (-1) ^ i \dbinom{m}{i}(m - i) ^ n
$$</div><p>显然是一个卷积的形式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span><span class="markdown-them-math-inline">$\rm NTT$</span> 即可做到 <span class="markdown-them-math-inline">$\mathcal{O(n \log n)}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h4 id="求一列第二类斯特林数">求一列第二类斯特林数</h4>
<p>不难发现第二类斯特林数的定义与 <span class="markdown-them-math-inline">$\exp$</span> 的组合意义很相似<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>于是我们考虑 <span class="markdown-them-math-inline">$\rm EGF:$</span> <span class="markdown-them-math-inline">$\widehat F(x) = \sum\limits_{i = 1} ^ \infty \frac{x ^ i}{i!} = e ^ x - 1$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>那么根据 <span class="markdown-them-math-inline">$\rm EGF$</span> 相乘的组合意义<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span><span class="markdown-them-math-inline">$[\dfrac{x ^ n}{n!}]\widehat F ^ m(x) = [\dfrac{x ^ n}{n!}](e ^ x - 1) ^ m = \begin{Bmatrix}n \\ m\end{Bmatrix}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>使用多项式快速幂即可做到 <span class="markdown-them-math-inline">$\mathcal{O(n \log n)}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h3 id="第一类斯特林数">第一类斯特林数</h3>
<h4 id="定义-1">定义</h4>
<p>定义 <span class="markdown-them-math-inline">$\begin{bmatrix}n \\ m\end{bmatrix}$</span> 为将 <span class="markdown-them-math-inline">$n$</span> 个数划分成 <span class="markdown-them-math-inline">$m$</span> 个互不区分的非空置换的方案数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h4 id="递推式-1">递推式</h4>
<div class="markdown-them-math-block">$$\begin{bmatrix}n \\ m\end{bmatrix} = \begin{bmatrix}n - 1 \\ m - 1\end{bmatrix} + (n - 1) \times \begin{bmatrix}n - 1 \\ m\end{bmatrix}
$$</div><p>由组合意义不难证明<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h4 id="求一行第一类斯特林数">求一行第一类斯特林数</h4>
<p>因为第一类斯特林数不具有较好的组合意义<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>因此不能像第二类斯特林数那样使用另一种方式来描述其<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>因此我们直接考虑第一类斯特林数的 <span class="markdown-them-math-inline">$\rm OGF$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
F_i(x) &amp;= \sum\limits_j ^ \infty \begin{bmatrix}i \\ j\end{bmatrix} x ^ j \\
&amp;= x \times F_{i - 1}(x) + (i - 1) F_{i - 1}(x) \\
&amp;= (i + x - 1) F_{i - 1}(x) \\
&amp;= \prod\limits_j ^ {i - 1} (x + j)
\end{aligned}
$$</div><p>那么就有<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$F_n(x) = \prod\limits_i ^ {n - 1} (x + i)
$$</div><p>当然可以直接使用启发式合并做到 <span class="markdown-them-math-inline">$\mathcal{O(n \log ^ 2n)}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>但还存在一个更加优秀的方法<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>倍增法<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$F_{2n}(x) = F_n(x) \times F_n(x + n)
$$</div><p>只需快速计算 <span class="markdown-them-math-inline">$F_n(x + n)$</span> 即可<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>令 <span class="markdown-them-math-inline">$F_n(x) = \sum\limits_i ^ \infty f_i x ^ i$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
F_n(x + n) &amp;= \sum\limits_i ^ n f_i(x + n) ^ i \\
&amp;= \sum\limits_i ^ n f_i\sum\limits_j ^ i x ^ j n ^ {i - j}
\end{aligned}
$$</div><p>后者很明显是一个卷积的形式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>直接计算即可<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>根据倍增的复杂度<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>可以做到 <span class="markdown-them-math-inline">$\mathcal{O(n \log n)}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h4 id="求一列第一类斯特林数">求一列第一类斯特林数</h4>
<p>类似于求一列第二类斯特林数的方法<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>考虑 <span class="markdown-them-math-inline">$\rm EGF:$</span> <span class="markdown-them-math-inline">$\widehat F(x) = \sum\limits_i ^ \infty \dfrac{(i - 1)!x ^ i}{i!} = \sum\limits_i ^ \infty \dfrac{x ^ i}{i} = \ln\left(\dfrac{1}{1 - x}\right)$</span></p>
<p>那么就有<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{bmatrix}n \\ m\end{bmatrix} = [\frac{x ^ n}{n!}]\widehat F ^ m(x)
$$</div><p>使用多项式快速幂即可<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>复杂度 <span class="markdown-them-math-inline">$\mathcal{O(n \log n)}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h3 id="普通幂,-上升幂, 下降幂的转换">普通幂, 上升幂, 下降幂的转换</h3>
<p>先介绍两个最简单的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>上升幂和下降幂的转换<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$x ^ {\underline{n}} = (-1) ^ n (-x) ^ {\overline n}
$$</div><div class="markdown-them-math-block">$$x ^ {\overline{n}} = (-1) ^ n (-x) ^ {\underline n}
$$</div><p>再根据我们求一行斯特林数的方法<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>可以得到上升幂转普通幂公式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$x ^ {\overline n} = \sum\limits_i ^ n \begin{bmatrix} n \\ i \end{bmatrix} x ^ i
$$</div><p>而根据第二类斯特林数的组合意义<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>再根据普通幂 <span class="markdown-them-math-inline">$x ^ n$</span> 的组合意义<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>可以得到普通幂转下降幂公式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$x ^ n = \sum\limits_i ^ x \dbinom{x}{i} \begin{Bmatrix} n \\ i \end{Bmatrix} i! = \sum\limits_i ^ x \begin{Bmatrix} n \\ i \end{Bmatrix} x ^ {\underline{i}}
$$</div><p>再利用最开始提到的下降幂转上升幂公式变形<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们可以得到普通幂转上升降幂公式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
(-x) ^ n &amp;= \sum\limits_i ^ x \begin{Bmatrix} n \\ i \end{Bmatrix} (-x) ^ {\underline{i}} \\
&amp;= \sum\limits_i ^ x \begin{Bmatrix} n \\ i \end{Bmatrix} (-1) ^ i x ^ {\overline{i}}
\end{aligned}
$$</div><div class="markdown-them-math-block">$$\Longleftrightarrow x ^ n = \sum\limits_i ^ x (-1) ^ {n - i}\begin{Bmatrix} n \\ i \end{Bmatrix}x ^ {\overline{i}}
$$</div><p>同理可得下降幂转普通幂公式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$x ^ {\underline{n}} = \sum\limits_i ^ x (-1) ^ {n - i} \begin{bmatrix} n \\ i \end{bmatrix} x ^ i
$$</div><p>总结一下四个公式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>普通幂转出去使用第二类斯特林数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>转回来使用第一类斯特林数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>阶数上升<span class="bd-box"><h-char class="bd bd-end"><h-inner>（</h-inner></h-char></span>下转普<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>普转上<span class="bd-box"><h-char class="bd bd-beg"><h-inner>）</h-inner></h-char></span>加 <span class="markdown-them-math-inline">$-1$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>通过这四个公式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们也能完成一般多项式和上升幂下降幂多项式的互相转化<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><strong>我们来看看这几个式子有什么应用<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></strong></p>
<p><strong>例题<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></strong> 给定 <span class="markdown-them-math-inline">$k$</span> 次多项式 <span class="markdown-them-math-inline">$f(x)$</span> 的各项系数和一个整数 <span class="markdown-them-math-inline">$n$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>求以下式子对 <span class="markdown-them-math-inline">$998244353$</span> 取模后的值 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\sum_{i=0}^n\dbinom{n}{i}2^{n-i}f(i)
$$</div><p>我们发现带 <span class="markdown-them-math-inline">$f(x)$</span> 的式子没有前途<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>于是将其拆开 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\sum_{i=0}^n\dbinom{n}{i}2^{n-i}\sum_{j=0}^ka_ji^j
$$</div><p>这里有个套路是将整数幂转第二类斯特林数 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
    m^n&amp;=\sum_{k=0}^m\dbinom{m}{k}\begin{Bmatrix}n\\m-k\end{Bmatrix}(m-k)!\\&amp;=\sum_{k=0}^m\begin{Bmatrix}n\\k\end{Bmatrix}m^{\underline{k}}
\end{aligned}
$$</div><p>转化的含义是将 <span class="markdown-them-math-inline">$m^n$</span> 看作 <span class="markdown-them-math-inline">$\rm LLA$</span> 问题的方案数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们发现 <span class="markdown-them-math-inline">$\small\begin{Bmatrix}n\\m\end{Bmatrix}$</span> 是 <span class="markdown-them-math-inline">$\rm LUB$</span> 问题的方案数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>于是枚举 <span class="markdown-them-math-inline">$m$</span> 个集合中有 <span class="markdown-them-math-inline">$k$</span> 个 <span class="markdown-them-math-inline">$0$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>然后用第二类斯特林数将 <span class="markdown-them-math-inline">$\rm LUA$</span> 算出来后乘上 <span class="markdown-them-math-inline">$(m-k)!$</span> 得到 <span class="markdown-them-math-inline">$\rm LLA$</span> 的方案数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>于是就可以开始推式子了 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
    &amp;\quad~\sum_{i=0}^n\dbinom{n}{i}2^{n-i}f(i)\\&amp;=\sum_{i=0}^n\dbinom{n}{i}2^{n-i}\sum_{j=0}^ka_ji^j\\&amp;=\sum_{i=0}^n\dbinom{n}{i}2^{n-i}\sum_{j=0}^ka_j\sum_{p=0}^i\dbinom{i}{p}\begin{Bmatrix}j\\p\end{Bmatrix}p!\\&amp;=\sum_{i=0}^n\sum_{j=0}^k\sum_{p=0}^i\dbinom{n}{i}\dbinom{i}{p}2^{n-i}a_j\begin{Bmatrix}j\\p\end{Bmatrix}p!\\&amp;=\sum_{j=0}^ka_j\sum_{p=0}^n\begin{Bmatrix}j\\p\end{Bmatrix}p!\sum_{i=p}^n\dbinom{n}{i}\dbinom{i}{p}2^{n-i}\\&amp;=\sum_{j=0}^ka_j\sum_{p=0}^n\begin{Bmatrix}j\\p\end{Bmatrix}p!\sum_{i=p}^n\dbinom{n}{p}\dbinom{n-p}{i-p}2^{n-i}\\&amp;=\sum_{j=0}^ka_j\sum_{p=0}^n\dbinom{n}{p}\begin{Bmatrix}j\\p\end{Bmatrix}p!\sum_{i=0}^{n-p}\dbinom{n-p}{i}2^{n-p-i}\\&amp;=\sum_{j=0}^k\sum_{p=0}^na_j\begin{Bmatrix}j\\p\end{Bmatrix}\dbinom{n}{p}p!3^{n-p}\\&amp;=\sum_{j=0}^k\sum_{p=0}^j\begin{Bmatrix}j\\p\end{Bmatrix}a_j\times n^{\underline{p}}\times 3^{n-p}
\end{aligned}
$$</div><p>最后这个式子可以通过预处理第二类斯特林数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span><span class="markdown-them-math-inline">$3$</span> 的次幂和 <span class="markdown-them-math-inline">$n$</span> 的 <span class="markdown-them-math-inline">$p$</span> 阶下降幂做到 <span class="markdown-them-math-inline">$\Theta(k^2)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h3 id="斯特林反演-1">斯特林反演</h3>
<p>非常类似二项式反演的形式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>有<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$f_n = \sum\limits_i ^ n \begin{Bmatrix} n \\ i \end{Bmatrix} g_i \Longleftrightarrow g_n = \sum\limits_i ^ n (-1) ^ {n - i} \begin{bmatrix} n \\ i \end{bmatrix} f_i
$$</div><p>我们首先需要了解斯特林反演基于的恒等式 <span class="markdown-them-math-inline">$-$</span> 反转公式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\sum\limits_{i = m} ^ n (-1) ^ {n - i} \begin{Bmatrix} n \\ i \end{Bmatrix} \begin{bmatrix} i \\ m \end{bmatrix} = [n = m]
$$</div><div class="markdown-them-math-block">$$\sum\limits_{i = m} ^ n (-1) ^ {n - i} \begin{bmatrix} n \\ i \end{bmatrix} \begin{Bmatrix} i \\ m \end{Bmatrix} = [n = m]
$$</div><p>不难发现两式的形式非常类似<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们只证明第一条式子<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>第二条式子是类似的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
x ^ n &amp;= \sum\limits_i ^ n \begin{Bmatrix} n \\ i \end{Bmatrix} x ^ {\underline{i}} \\
&amp;= \sum\limits_i ^ n \begin{Bmatrix} n \\ i \end{Bmatrix} (-1) ^ i (-x) ^ {\overline{i}} \\
&amp;= \sum\limits_i ^ n (-1) ^ i \begin{Bmatrix} n \\ i \end{Bmatrix} \sum\limits_j ^ i (-1) ^ j \begin{bmatrix} i \\ j \end{bmatrix} x ^ j \\
&amp;= \sum\limits_i ^ n \left( \sum\limits_{j = i} ^ n (-1) ^ {i - j} \begin{Bmatrix} n \\ j \end{Bmatrix} \begin{bmatrix} j \\ i \end{bmatrix}\right) x ^ i
\end{aligned}
$$</div><p>根据多项式恒等原理即可证明第一条反转公式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>有了这两条反转公式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>就可以直接将斯特林反演左式带入右式以及右式带入左式来证明正确性了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>过程是不难的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h2 id="min-max-反演">Min-Max 反演</h2>
<p>令 <span class="markdown-them-math-inline">$\max\limits_k(S)$</span> 表示有限集 <span class="markdown-them-math-inline">$S$</span> 中的最大值<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span><span class="markdown-them-math-inline">$\min\limits_k(S)$</span> 表示有限集中的最小值<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h3 id="基本形式">基本形式</h3>
<div class="markdown-them-math-block">$$\max(S)=\sum\limits_{T\subseteq S}(-1)^{|T|-1}\min(T)
$$</div><p>可以发现<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>对于所有 <span class="markdown-them-math-inline">$T\subseteq S-\{\max(S)\}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>均存在 <span class="markdown-them-math-inline">$T+\max(S)\subseteq S$</span> 与之一一对应<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>且 <span class="markdown-them-math-inline">$\min(T)=\min(T+\max(S))$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span> 由于它们的大小恰好相差 <span class="markdown-them-math-inline">$1$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>故对每个集合 <span class="markdown-them-math-inline">$S$</span> 配上 <span class="markdown-them-math-inline">$(-1)^{|S|}$</span> 的系数可以恰好它们消掉<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>最后仅剩下集合 <span class="markdown-them-math-inline">$\{\max(S)\}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>它的最小值恰好等于 <span class="markdown-them-math-inline">$\max(S)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>同理 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\min(S)=\sum\limits_{T\subseteq S}(-1)^{|T|-1}\max(T)
$$</div><h3 id="拓展形式">拓展形式</h3>
<div class="markdown-them-math-block">$$\max_k(S)=\sum_{T\subseteq S,|T|\geqslant k}(-1)^{|T|-k}\dbinom{|T|-1}{k-1}\min(T)
$$</div><p>考虑 <span class="markdown-them-math-inline">$S$</span> 中的第 <span class="markdown-them-math-inline">$i$</span> 大数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>它作为最小值被包含在大小为 <span class="markdown-them-math-inline">$|T|$</span> 的集合中共 <span class="markdown-them-math-inline">$\binom{i-1}{|T|-1}$</span> 次<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>每次出现会乘上 <span class="markdown-them-math-inline">$\binom{|T|-1}{k-1}$</span> 的权值<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>故一个数 <span class="markdown-them-math-inline">$\max\limits_i(S)$</span> 的总贡献为 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
    val_i&amp;=\max_i(S)\sum_{|T|=k}^i(-1)^{|T|-k}\dbinom{i-1}{|T|-1}\dbinom{|T|-1}{k-1}\\&amp;=\max_i(S)\dbinom{i-1}{k-1}\sum_{|T|=k}^i(-1)^{|T|-k}\dbinom{i-k}{|T|-k}\\&amp;=\max_i(S)\dbinom{i-1}{k-1}[i=k]
\end{aligned}
$$</div><p>所有数的贡献之和即为 <span class="markdown-them-math-inline">$\sum\limits_{i=1}^{|S|}val_i=\max\limits_k(S)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>故原式成立<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>另外<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>由于期望具有线性性<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>所以上面的式子在期望意义下也成立<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><strong>我们来看看 <span class="markdown-them-math-inline">$\rm Min-Max$</span> 反演有什么应用<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></strong></p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4707"><strong>重返现世</strong></a> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>你需要收集 <span class="markdown-them-math-inline">$n$</span> 种物品中的任意 <span class="markdown-them-math-inline">$k$</span> 种<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>每个时刻会有一种物品被生成<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>第 <span class="markdown-them-math-inline">$i$</span> 种物品被生成的概率为 <span class="markdown-them-math-inline">$\frac{p_i}{m}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>如果你还没有收集这种物品则可以收集它<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>求你收集到这 <span class="markdown-them-math-inline">$n$</span> 个物品中任意 <span class="markdown-them-math-inline">$k$</span> 个的期望时间<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>保证 <span class="markdown-them-math-inline">$k\leqslant n\leqslant 10^3,|n-k|\leqslant 10,0\leqslant p_i\leqslant m,\sum p=m,m\leqslant 10^4$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>首先可以发现所有物品出现的时间不重<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>故构成一个集合<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>所以题目要求的为 <span class="markdown-them-math-inline">$E\left(\max (S)_{k}\right)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>套用拓展 <span class="markdown-them-math-inline">$\rm Min -Max$</span> 得到:</p>
<div class="markdown-them-math-block">$$E\left(\max (S)_{k}\right)=\sum_{T \subseteq S}\left(\begin{array}{c}
|T|-1 \\
k-1
\end{array}\right)(-1)^{|T|-k} E(\min (T))
$$</div><p>我们知道原来要求的是全集合中出现时间排第 <span class="markdown-them-math-inline">$k$</span> 的元素<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>由于变成了正过来看<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>此时的 <span class="markdown-them-math-inline">$k$</span> 变成了 <span class="markdown-them-math-inline">$n-k+ 1$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>它的值非常小<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>我们知道一个集合每次操作出现一个属于它的元素的概率为:</p>
<div class="markdown-them-math-block">$$e(S)=\sum_{i \in S} \frac{p_{i}}{m}
$$</div><p>于是我们知道期望时间为:</p>
<div class="markdown-them-math-block">$$\sum_{i=1}^{\infty} e(S)(1-e(S))^{i-1}=\frac{1}{e(S)}
$$</div><p>于是现在我们得到了一个复杂度为 <span class="markdown-them-math-inline">$\Theta\left(2^{n}\right)$</span> 的做法<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>暴力枚举子集<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>对于每个集合求出此式子并计算贡献<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>然后我们来看这个式子:</p>
<div class="markdown-them-math-block">$$E\left(\max (S)_{k}\right)=\sum_{T \subseteq S}\left(\begin{array}{c}
|T|-1 \\
k-1
\end{array}\right)(-1)^{|T|-k} E(\min (T))
$$</div><p>考虑一个固定的集合大小 <span class="markdown-them-math-inline">$|T|$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>其分配的系数相同均为 <span class="markdown-them-math-inline">$\left(\begin{array}{c}|T|-1 \\ k-1\end{array}\right)(-1)^{|T|-k}$</span></p>
<p>则我们只需要求出 <span class="markdown-them-math-inline">$\sum_{|T|=x} E(\min (T))$</span></p>
<p>注意到 <span class="markdown-them-math-inline">$E(\min (T))=\frac{1}{e(S)}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>于是我们可以给 <span class="markdown-them-math-inline">$d p$</span> 加一个维度记录 <span class="markdown-them-math-inline">$\sum p=e(S)$</span>, 这样只需要统计有多少 个点满足 <span class="markdown-them-math-inline">$\sum p=i,|T|=j$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>于是不妨记 <span class="markdown-them-math-inline">$d p_{i, j, k}$</span> 表示考虑到前 <span class="markdown-them-math-inline">$i$</span> 个数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>满足 <span class="markdown-them-math-inline">$|T|=j, \sum p=k$</span> 的集合数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>则可以得到转移:</p>
<div class="markdown-them-math-block">$$d p_{i, j, k}=d p_{i-1, j, k}+d p_{i-1, j-1, k-p_{i}}
$$</div><p>这样便可以得到一个复杂度为 <span class="markdown-them-math-inline">$\Theta\left(n^{2} m\right)$</span> 的做法了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>现在问题在于如何优化复杂度 <span class="markdown-them-math-inline">$?$</span></p>
<p>我们发现转移已经是最优了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>不能从这里下手<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>于是只能从状态下手<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>由于 <span class="markdown-them-math-inline">$k$</span> 这一维附带了一个 <span class="markdown-them-math-inline">$\frac{1}{k}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>于是肯定定是不能省略的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>唯一的办法是把记录中的 <span class="markdown-them-math-inline">$|T|$</span> 给去掉试试<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>换而言之我们只统计到第 <span class="markdown-them-math-inline">$i$</span> 个数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>任意放满足 <span class="markdown-them-math-inline">$\sum p=k$</span> 的数前面安排的系数之和<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>考虑系数为:</p>
<div class="markdown-them-math-block">$$\sum\left(\begin{array}{c}
|T|-1 \\
k-1
\end{array}\right)(-1)^{|T|-k}
$$</div><p>拆开试试 ?</p>
<div class="markdown-them-math-block">$$\sum \frac{(|T|-1) !}{(k-1) !(|T|-k) !}(-1)^{|T|-k}
$$</div><p>好像还是不行……</p>
<p>但是这个时候可以得到转移大致为<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$d p_{i, j}=d p_{i-1, j}+\ldots
$$</div><p>这个奇怪的东西应该表示为:</p>
<p>对于 <span class="markdown-them-math-inline">$d p_{i-1, j-p i}$</span> 的:</p>
<div class="markdown-them-math-block">$$\sum\left(\begin{array}{c}
|T|-1 \\
k-1
\end{array}\right)(-1)^{|T|-k}
$$</div><p>首先可以注意到所有 <span class="markdown-them-math-inline">$|T| \rightarrow|T|+1$</span> 于是整体需要乘一个 <span class="markdown-them-math-inline">$-1$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>注意到 <span class="markdown-them-math-inline">$|T| \rightarrow|T|+1$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>于是组合数变成了:</p>
<div class="markdown-them-math-block">$$\left(\begin{array}{c}
|T| \\
k-1
\end{array}\right)
$$</div><p>但是我们知道组合数可以递推所以有:</p>
<div class="markdown-them-math-block">$$\left(\begin{array}{c}
|T| \\
k-1
\end{array}\right)=\left(\begin{array}{c}
|T|-1 \\
k-1
\end{array}\right)+\left(\begin{array}{c}
|T|-1 \\
k-2
\end{array}\right)
$$</div><p>然而真正有趣的是这个式子可以放在一起一起递推<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>因为考虑计算 <span class="markdown-them-math-inline">$dp$</span> 时强制放入一个数则等价于 <span class="markdown-them-math-inline">$|T|$</span> 必然变大 <span class="markdown-them-math-inline">$1$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>于是我们可以给 <span class="markdown-them-math-inline">$dp$</span> 增加一个维度 <span class="markdown-them-math-inline">$k$</span> 来计算 <span class="markdown-them-math-inline">$dp$</span> 系数</p>
<div class="markdown-them-math-block">$$d p_{i, j, k}=d p_{i-1, j, k}+(-1) \times d p_{i-1, j-p i, k}+(-1)^{2} \times d p_{i-1, j-p i, k-1}
$$</div><p>即:</p>
<div class="markdown-them-math-block">$$d p_{i, j, k}=d p_{i-1, j, k}-d p_{i-1, j-p i, k}+d p_{i-1, j-p i, k-1}
$$</div><p>接下来考虑边界条件<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>这个好像有点难<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>因为我们的 <span class="markdown-them-math-inline">$dp$</span> 是按照转移的需求设计<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>所以它存在的实际意义也是为了方便转移而存在的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>我们知道 <span class="markdown-them-math-inline">$d p_{0, j, k}$</span> 的意义应该是: <span class="markdown-them-math-inline">$\sum_{\sum p=j}\left(\begin{array}{c}|T|-1 \\ k-1\end{array}\right)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>于是考虑前面的数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>唯一的一个 <span class="markdown-them-math-inline">$\sum p=j$</span> 是空集<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>即 <span class="markdown-them-math-inline">$\sum p=0$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>此时有 <span class="markdown-them-math-inline">$|T|=0$</span> 求的则是:</p>
<div class="markdown-them-math-block">$$dp_{0,0, k}=\dbinom{-1}{k-1}
$$</div><p>这个时候我们需要拓宽组合数的意义, 你可以认为 <span class="markdown-them-math-inline">$\binom{-1}{-1}=1$</span> 而 <span class="markdown-them-math-inline">$\binom{x}{y}$</span> 在 <span class="markdown-them-math-inline">$x&lt;y$</span> 的时候为 <span class="markdown-them-math-inline">$0$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span><span class="markdown-them-math-inline">$x=y$</span> 的时候为 <span class="markdown-them-math-inline">$1$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span> 所以 <span class="markdown-them-math-inline">$dp$</span> 的边界为 <span class="markdown-them-math-inline">$dp_{0,0,0}=1$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>转移的时候可以用滚动数组<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>总时间复杂度为 <span class="markdown-them-math-inline">$\Theta(nm(n-k))$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h3 id="gcd-lcm-反演">Gcd-Lcm 反演</h3>
<p>一般地<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>求 <span class="markdown-them-math-inline">$\rm lcm$</span> 通常转化为求解 <span class="markdown-them-math-inline">$\gcd$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>因为 <span class="markdown-them-math-inline">$\gcd$</span> 的性质更为优秀<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>也可以借助莫比乌斯反演<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>通用形式为<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\mathrm{lcm}(S) = \prod\limits_{T \subseteq S, T \ne \varnothing} \gcd(T) ^ {(-1) ^ {|T| - 1}}
$$</div><p>证明考虑使用 <span class="markdown-them-math-inline">$\rm Min-Max$</span> 容斥<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>考虑每个质因子 <span class="markdown-them-math-inline">$p$</span> 对左右的贡献<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
p ^ {\max(p, S)} &amp;= p ^ {\sum\limits_{T \subseteq S, T \ne \varnothing} (-1) ^ {|T| - 1} \min(p, T)} \\
&amp;= \prod\limits_{T \subseteq S, T \ne \varnothing} p ^ {(-1) ^ {|T| - 1} \min(p, T)} \\
&amp;= \prod\limits_{T \subseteq S, T \ne \varnothing} \left(p ^ {\min(p, T)}\right) ^ {(-1) ^ {|T| - 1} }
\end{aligned}
$$</div><p>那么有<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
\mathrm{lcm}(S) &amp;= \prod\limits_p p ^ {\max(p, S)} \\
&amp;= \prod\limits_{p} \prod\limits_{T \subseteq S, T \ne \varnothing} \left(p ^ {\min(p, T)}\right) ^ {(-1) ^ {|T| - 1} } \\
&amp;= \prod\limits_{T \subseteq S, T \ne \varnothing} \left(\prod\limits_p p ^ {\min(p, T)}\right) ^ {(-1) ^ {|T| - 1} } \\
&amp;= \prod\limits_{T \subseteq S, T \ne \varnothing} \gcd(T) ^ {(-1) ^ {|T| - 1}}
\end{aligned}
$$</div><p><strong>我们来看看 <span class="markdown-them-math-inline">$\rm Gcd-Lcm$</span> 反演有什么应用<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></strong></p>
<p><strong>前路<span class="bd-box"><h-char class="bd bd-end"><h-inner>（</h-inner></h-char></span>出题人<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>本校学长 @<span class="markdown-them-math-inline">$\rm remoon$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>）</h-inner></h-char></span>:</strong></p>
<p>给定 <span class="markdown-them-math-inline">$A,B,C$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>求 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\sum_{i=1}^A\sum_{j=1}^B\sum_{k=1}^C\mathrm{lcm}(i,j,k)
$$</div><p>保证 <span class="markdown-them-math-inline">$A,B,C\leqslant 5\times 10^4$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>答案对 <span class="markdown-them-math-inline">$10^9+7$</span> 取模<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><strong>首先给出一个复杂度估界为 <span class="markdown-them-math-inline">$\Theta(n^2)$</span> 的做法<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>但实测非常快<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></strong></p>
<p>请注意<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>以下的推导遵循一个原则<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>对 <span class="markdown-them-math-inline">$i, j, k$</span> 做相同变换<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>不会先处理一部分再处理一部分<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
Ans &amp;= \sum\limits_{i = 1} ^ A \sum\limits_{j = 1} ^ B \sum\limits_{k = 1} ^ C \mathrm{lcm}(i, j, k) \\
&amp;= \sum\limits_{i = 1} ^ A \sum\limits_{j = 1} ^ B \sum\limits_{k = 1} ^ C \frac{ijk(i, j, k)}{(i, j)(j, k)(k, i)} \qquad (\mathrm{Min-Max} ~ for ~ index) \\
&amp;= \sum\limits_{i = 1} ^ A \sum\limits_{j = 1} ^ B \sum\limits_{k = 1} ^ C \frac{ijk}{(i, j)(j, k)(k, i)} \left( f \times \mu \times I \left((i, j, k)\right)\right) \qquad (f(i) = i)\\
&amp;= \sum\limits_{d = 1} ^ A f \times \mu (d) \sum\limits_{i = 1} ^ {A / d} \sum\limits_{i = 1} ^ {B / d} \sum\limits_{i = 1} ^ {C / d} \frac{ijk}{(i, j)(j, k)(k, i)}
\end{aligned}
$$</div><p>令 <span class="markdown-them-math-inline">$F(A, B, C) = \sum\limits_{i = 1} ^ A \sum\limits_{i = 1} ^ B \sum\limits_{i = 1} ^ C \dfrac{ijk}{(i, j)(j, k)(k, i)}, g(i) = \dfrac{1}{i}, h = g \times \mu$</span> 则<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\begin{aligned}
F(A, B, C) &amp;= \sum\limits_{i = 1} ^ A \sum\limits_{i = 1} ^ B \sum\limits_{i = 1} ^ C ijk ( f \times \mu \times I ((i, j)))( f \times \mu \times I ((j, k)))( f \times \mu \times I ((k, i))) \\
&amp;= \sum\limits_{i = 1} ^ A \sum\limits_{i = 1} ^ B \sum\limits_{i = 1} ^ C ijk \sum\limits_{x \mid (i, j)} g \times \mu(x) \sum\limits_{y \mid (j, k)} g \times \mu(y) \sum\limits_{z \mid (k, i)} g \times \mu(z) \\
&amp;= \sum\limits_{x = 1} ^ A \sum\limits_{y = 1} ^ B \sum\limits_{z = 1} ^ C h(x) h(y) h(z) \sum\limits_{x, z \mid i} i \sum\limits_{x, y \mid j} j \sum\limits_{y, z \mid k} k \\
&amp;= \sum\limits_{x = 1} ^ A \sum\limits_{y = 1} ^ B \sum\limits_{z = 1} ^ C h(x) h(y) h(z) \sum\limits_{i = 1} ^ {A / \mathrm{lcm}(x, z)} i \times \mathrm{lcm}(x, z) \sum\limits_{j = 1} ^ {B / \mathrm{lcm}(x, y)} j \times \mathrm{lcm}(x, y) \sum\limits_{k = 1} ^ {C / \mathrm{lcm}(y, z)} k \times \mathrm{lcm}(y, z) \\
&amp;= \sum\limits_{x = 1} ^ A \sum\limits_{y = 1} ^ B \sum\limits_{z = 1} ^ C h(x) h(y) h(z) S(A, \mathrm{lcm}(x, z)) S(B, \mathrm{lcm}(x, y)) S(C, \mathrm{lcm}(y, z))
\end{aligned}
$$</div><p>可以发现<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>后者 <span class="markdown-them-math-inline">$x \rightarrow y \rightarrow z \rightarrow x$</span> 构成了一个三元环<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们可以大概给出估界为 <span class="markdown-them-math-inline">$\mathcal{O(n \log n \log \log n)}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span> 因此暴力找出所有三元环的复杂度为<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span><span class="markdown-them-math-inline">$\mathcal{O(n \log n \log \log n\sqrt{n \log n \log \log n})}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>同时<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>因为这个在 <span class="markdown-them-math-inline">$n = 5000$</span> 时与 <span class="markdown-them-math-inline">$n ^ 2$</span> 无区别<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>因此连边可以使用暴力<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>但也可以枚举 <span class="markdown-them-math-inline">$\mathrm{Lcm}$</span> 再枚举其约数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>使用 <span class="markdown-them-math-inline">$\mathcal{O(n \log ^ 3n)}$</span> 连边<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>此时我们算完了 <span class="markdown-them-math-inline">$F$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>可知总共需要算的 <span class="markdown-them-math-inline">$F$</span> 只有 <span class="markdown-them-math-inline">$\sqrt{n}$</span> 种<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>若将单次复杂度看作 <span class="markdown-them-math-inline">$n ^ 2$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>因此总复杂度<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\mathcal{O(n ^ 2\sum\limits_{i = 1} ^ {n} \frac{1}{i ^ 2})} = O(n ^ 2)
$$</div><p>经过卡常之后<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>效率提升大约五倍多<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>以下是如何卡常的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<p>我写了一个大范围内的打表程序<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>发现实际原做法的连边数量大约是 <span class="markdown-them-math-inline">$n \log n \log \log n$</span> 级别的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>因此这个做法很有卡常前途<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<ul>
<li>
<p>我们把暴力连边换掉<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>枚举其约数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>使用 <span class="markdown-them-math-inline">$\mathcal{O(n \log ^ 3n)}$</span> 连边<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>连边暴力判断时不要求 <span class="markdown-them-math-inline">$\rm lcm$</span> 只需要求 <span class="markdown-them-math-inline">$\gcd(i / d_j, i / d_k)$</span> 具体参见代码<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>如果你想要过本题<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>是一定要优化连边的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</li>
<li>
<p>可以发现我们需要调用的 <span class="markdown-them-math-inline">$\rm lcm$</span> 只有每条边的两个端点<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>而在枚举 <span class="markdown-them-math-inline">$\rm Lcm$</span> 时是可以 <span class="markdown-them-math-inline">$\mathcal{O(1)}$</span> 得知的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>因此我们在连边时记录这个值<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</li>
<li>
<p>可以发现<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span><span class="markdown-them-math-inline">$S$</span> 函数有很多是无用的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>有用的第一维只有 <span class="markdown-them-math-inline">$\sqrt{A}$</span> 个<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>因此可以只预处理 <span class="markdown-them-math-inline">$A \sqrt{A}$</span> 个值<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</li>
<li>
<p><span class="markdown-them-math-inline">$\gcd$</span> 请不要暴力求<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们记忆化 <span class="markdown-them-math-inline">$a, b \leqslant 2e4$</span> 的部分<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>并用 <span class="markdown-them-math-inline">$\rm short$</span> 类型存储<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>减少空间消耗<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</li>
</ul>
<p><strong>然后我们再给出一个复杂度为 <span class="markdown-them-math-inline">$\Theta(n^{1.5})$</span> 的正解做法<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></strong></p>
<p>方便起见用 <span class="markdown-them-math-inline">$(x, y)$</span> 代指 <span class="markdown-them-math-inline">$\operatorname{gcd}(x, y)$</span></p>
<div class="markdown-them-math-block">$$\sum_{i=1}^{A} \sum_{j=1}^{B} \sum_{k=1}^{C} \frac{(i, j, k) i j k}{(i, j)(j, k)(i, k)}
$$</div><p>枚举 <span class="markdown-them-math-inline">$d$</span>, 设 <span class="markdown-them-math-inline">$F(A, B, C)=\sum_{i=1}^{A} \sum_{j=1}^{B} \sum_{k=1}^{C} \frac{i j k}{(i, j)(j, k)(i, k)}$</span> 考虑计算:</p>
<div class="markdown-them-math-block">$$\sum_{d} \varphi(d) F\left(\frac{A}{d}, \frac{B}{d}, \frac{C}{d}\right)
$$</div><p>令 <span class="markdown-them-math-inline">$n=\max (A, B, C)$</span>, 假定我们可以在 <span class="markdown-them-math-inline">$\mathcal{O}\left(n^{c} \log ^{k} n\right)$</span> 的复杂度计算一组 <span class="markdown-them-math-inline">$F(A, B, C)$</span>, 则当 <span class="markdown-them-math-inline">$c&gt;1$</span> 时<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>恒有 <span class="markdown-them-math-inline">$\sum \frac{1}{d^{c}}$</span> 是收敛的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>可以认为其为常数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span> (不过比较大)<br>
只需要考虑快速计算一组 <span class="markdown-them-math-inline">$F(A, B, C)$</span>, <span class="markdown-them-math-inline">$\rm remoon$</span> 给出的做法是同时反演三组<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>然后考虑通过三元环计数来计算答案<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>这里给出略为不同的思路:</p>
<div class="markdown-them-math-block">$$\begin{aligned}
&amp;F(A, B, C)=\sum_{i=1}^{A} \sum_{j=1}^{B} \sum_{k=1}^{C} \frac{i j k}{(i, j)(j, k)(i, k)} \\
&amp;=\sum_{k} k \sum_{d}(f * \mu)(d) \sum_{d \mid i}^{A} \frac{i}{\operatorname{gcd}(i, k)} \sum_{d \mid j}^{B} \frac{j}{\operatorname{gcd}(j, k)} \\
&amp;=\sum_{k} k \sum_{d}(f * \mu)(d) \frac{d^{2}}{\operatorname{gcd}(k, d)^{2}}\left(\sum_{i=1}^{A / d} \frac{i}{\operatorname{gcd}\left(i, \frac{k}{\operatorname{gcd}(k, d)}\right)}\right)\left(\sum_{i=1}^{B / d} \frac{i}{\operatorname{gcd}\left(i, \frac{k}{\operatorname{gcd}(k, d)}\right)}\right)
\end{aligned}
$$</div><p>不妨设 <span class="markdown-them-math-inline">$F(t, x)=\sum_{i \leq t} \frac{i}{\operatorname{gcd}(i, x)}$</span>, 记 <span class="markdown-them-math-inline">$g(d)=(f * \mu)(d) d^{2}$</span><br>
答案等价于<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\sum_{k}^{C} k \sum_{d} \frac{g(d)}{\operatorname{gcd}(k, d)^{2}} F\left(\frac{A}{d}, \frac{k}{\operatorname{gcd}(k, d)}\right) F\left(\frac{B}{d}, \frac{k}{\operatorname{gcd}(k, d)}\right)
$$</div><p>枚举 <span class="markdown-them-math-inline">$\frac{k}{\operatorname{gcd}(k, d)}$</span> 为 <span class="markdown-them-math-inline">$x$</span>, 此时考虑到我们只需要计算 <span class="markdown-them-math-inline">$\mathcal{O}(n \sqrt{n})$</span> 组 <span class="markdown-them-math-inline">$F(n, x)$</span><br>
考虑到 <span class="markdown-them-math-inline">$F(n, x)$</span> 事实上就是:</p>
<div class="markdown-them-math-block">$$\begin{aligned}
&amp;\sum_{i=1}^{n} \frac{i}{\operatorname{gcd}(i, x)} \\
&amp;=\sum_{d \mid x}(f * \mu)(d) \times d S\left(\frac{n}{d}\right)
\end{aligned}
$$</div><p>枚举这 <span class="markdown-them-math-inline">$\sqrt{A}$</span> 种 <span class="markdown-them-math-inline">$n$</span>, 可以发现后式就是一个高维前缀和的形式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>可以在 <span class="markdown-them-math-inline">$\mathcal{O}\left(n^{1.5} \log \log n \sim n^{1.5} \log n\right)$</span> 的复杂度完成计算<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span> 考虑前半部分<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>不妨枚举 <span class="markdown-them-math-inline">$d, \operatorname{gcd}(k, d)$</span> <span class="bd-box"><h-char class="bd bd-end"><h-inner>（</h-inner></h-char></span>设为 <span class="markdown-them-math-inline">$t$</span> ) 以及 <span class="markdown-them-math-inline">$x$</span>, 此时我们知道:</p>
<ul>
<li><span class="markdown-them-math-inline">$k=x t$</span>, 故 <span class="markdown-them-math-inline">$x t \leq C$</span></li>
<li><span class="markdown-them-math-inline">$t \mid d$</span></li>
<li><span class="markdown-them-math-inline">$\operatorname{gcd}\left(\frac{d}{t}, x\right)=1$</span></li>
<li>固定了 <span class="markdown-them-math-inline">$\frac{A}{d}, \frac{B}{d}$</span> 之后<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们可以发现 <span class="markdown-them-math-inline">$d$</span> 属于区间 <span class="markdown-them-math-inline">$[l, r]$</span>, 此时我们考虑将答案差分<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>简而言之<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们的任务是计算 <span class="markdown-them-math-inline">$n \sqrt{n}$</span> 次下式:</li>
<li></li>
</ul>
<div class="markdown-them-math-block">$$\begin{aligned}
&amp;x \sum_{d \leq R} g(d) \sum_{t \mid d} \frac{1}{t}[x t \leq C]\left[\operatorname{gcd}\left(x, \frac{d}{t}\right)=1\right] \\
&amp;=x \sum_{c \mid x} \mu(c) \sum_{c \mid d, d \leq R} g(d) \sum_{t \mid \frac{d}{\epsilon}} \frac{1}{t}\left[t \leq \frac{C}{x}\right]
\end{aligned}
$$</div><p>首先<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们不难考虑到本质不同的 <span class="markdown-them-math-inline">$\frac{C}{x}$</span> 只有 <span class="markdown-them-math-inline">$\sqrt{n}$</span> 种<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>可以考虑枚举每种 <span class="markdown-them-math-inline">$\frac{C}{x}=m$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>并在此时预处理:</p>
<div class="markdown-them-math-block">$$g(d) \sum_{t \mid d} \frac{1}{t}[t \leq m]
$$</div><p>对于某个 <span class="markdown-them-math-inline">$m$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>这可以在 <span class="markdown-them-math-inline">$\mathcal{O}(n \log \log n)$</span> 的复杂度完成计算<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>总体而言<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>此部分可以在 <span class="markdown-them-math-inline">$\mathcal{O}\left(n^{1.5} \log \log n \sim n^{1.5} \log n\right)$</span> 完成预处理<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>设其为 <span class="markdown-them-math-inline">$G\left(d, \frac{C}{x}\right)$</span><br>
最后<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>让我们为每个 <span class="markdown-them-math-inline">$c$</span> 考虑<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>穷举可能的 <span class="markdown-them-math-inline">$\sqrt{n}$</span> 种 <span class="markdown-them-math-inline">$m$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>并为每个 <span class="markdown-them-math-inline">$c$</span> 建立大小为 <span class="markdown-them-math-inline">$\frac{\max R}{c}$</span> 的表格<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>显然表格的总大小为 <span class="markdown-them-math-inline">$n \log n$</span>, 此时单组查询显然可以做到 <span class="markdown-them-math-inline">$\mathcal{O}(1)$</span>, 由于 <span class="markdown-them-math-inline">$x$</span> 穷举 <span class="markdown-them-math-inline">$1 \sim n$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>考察其约数个数和显然为 <span class="markdown-them-math-inline">$\mathcal{O}(n \log n)$</span>, 总体而言我们可以在 <span class="markdown-them-math-inline">$\mathcal{O}\left(n^{1.5} \log n\right)$</span> 解决此问题<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span><br>
一点新的思路:<br>
我们考虑枚举 <span class="markdown-them-math-inline">$c$</span>, 并为每个 <span class="markdown-them-math-inline">$c$</span>, 对 <span class="markdown-them-math-inline">$\frac{C / c}{x}$</span> 的所有可能的取值进行预处理<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>不难发现这个部分的复杂度为 <span class="markdown-them-math-inline">$\sum\left(\frac{n}{c}\right)^{1.5}$</span><br>
通过积分不难证明这部分等效于 <span class="markdown-them-math-inline">$n^{1.5}$</span></p>
<h2 id="莫比乌斯反演">莫比乌斯反演</h2>
<h3 id="一些定义和性质">一些定义和性质</h3>
<p><strong><span class="markdown-them-math-inline">$\rm Dirichlet$</span> 卷积 :</strong> <span class="markdown-them-math-inline">$\sum\limits_{d|n}f(d)g(\frac{n}{d})$</span> 被定义为 <span class="markdown-them-math-inline">$\rm Dirichlet$</span> 卷积<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><strong>莫比乌斯 <span class="markdown-them-math-inline">$(\mu)$</span> 函数 :</strong></p>
<div class="markdown-them-math-block">$$\mu(n)= \begin{cases}1 &amp; n=1 \\ 0 &amp; n \text { 含有平方因子 } \\ (-1)^{k} &amp; k \text { 为 } n \text { 的本质不同质因子个数 }\end{cases}
$$</div><p>显然<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span><span class="markdown-them-math-inline">$\mu$</span> 是积性函数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>且它还有一些更加巧妙的性质<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>其中最常用的一个是 <span class="markdown-them-math-inline">$\mu \times 1=\varepsilon$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><span class="markdown-them-math-inline">$\large\rm Proof:$</span></p>
<p>此处的乘号表示 <span class="markdown-them-math-inline">$\rm Dirichlet$</span> 卷积<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span><span class="markdown-them-math-inline">$1$</span> 表示常数函数 <span class="markdown-them-math-inline">$\forall x\in [1,+\infty),f(x)=1$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span><span class="markdown-them-math-inline">$\varepsilon$</span> 表示单位函数 <span class="markdown-them-math-inline">$\forall x\in [1,+\infty),f(x)=[x=1]$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>设 <span class="markdown-them-math-inline">$n=\prod_{i=1}^{k} p_{i}^{c_{i}}, n^{\prime}=\prod_{i=1}^{k} p_{i}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>那么 <span class="markdown-them-math-inline">$\sum\limits_{d \mid n} \mu(d)=\sum\limits_{d \mid n^{\prime}} \mu(d)=\sum\limits_{i=0}^{k}\tbinom{k}{i}\cdot(-1)^{i}=(1+(-1))^{k}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>根据二项式定理<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>易知该式子的值在 <span class="markdown-them-math-inline">$k=0$</span> 即 <span class="markdown-them-math-inline">$n=1$</span> 时值为 <span class="markdown-them-math-inline">$1$</span> 否则为 <span class="markdown-them-math-inline">$0$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>这也同时证明了 <span class="markdown-them-math-inline">$\sum\limits_{d \mid n} \mu(d)=[n=1]=\varepsilon(n)$</span> 以及 <span class="markdown-them-math-inline">$\mu * 1=\varepsilon$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h3 id="两个反演式子">两个反演式子</h3>
<div class="markdown-them-math-block">$$[n=1]=\sum_{d|n}\mu(d)
$$</div><p><span class="markdown-them-math-inline">$\large\rm Proof:$</span></p>
<div class="markdown-them-math-block">$$[n=1]=\varepsilon(n)=\mu \times 1(n)=\sum_{d|n}\mu(d)
$$</div><p><strong>我们来看看这个式子有什么应用<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></strong></p>
<p><a target="_blank" rel="noopener" href="http://zhengruioi.com/contest/1010/problem/2017"><strong>例题 :</strong></a> 给定一个长度为 <span class="markdown-them-math-inline">$n$</span> 的序列 <span class="markdown-them-math-inline">$a$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>给定 <span class="markdown-them-math-inline">$m$</span> 个询问 <span class="markdown-them-math-inline">$l,r,x$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>求 <span class="markdown-them-math-inline">$a_l,a_{l+1}......a_r$</span> 中有多少个数与 <span class="markdown-them-math-inline">$x$</span> 互质<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>保证 <span class="markdown-them-math-inline">$n,m,a_i,x\leqslant 10^5$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>考虑莫比乌斯反演: <span class="markdown-them-math-inline">$\left[\left(a_{i}, x\right)=1\right]=\sum\limits_{\left.d \mid a_{i}, x\right)} \mu(d)=\sum\limits_{d\left|a_{i}, d\right| x} \mu(d)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>由于答案求 <span class="markdown-them-math-inline">$\sum\limits_{i=l}^{r}\left[\left(a_{i}, x\right)=1\right]=\sum\limits_{i=l}^{r} \sum\limits_{d\left|a_{i}, d\right| x} \mu(d)=\sum\limits_{d \mid x} \mu(d) \sum\limits_{i=l}^{r}\left[d \mid a_{i}\right]_{\text {.}}$</span></p>
<p>考虑对于每一个数, 预处理出它的倍数出现在哪些位置, 然后询问时枚举所有 <span class="markdown-them-math-inline">$x$</span> 的因数, 二分一下即可求出 <span class="markdown-them-math-inline">$[l, r]$</span> 内它的倍数有多少个<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>时间复杂度 <span class="markdown-them-math-inline">$\Theta(n \sigma(\operatorname{maxa}) \log n)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>考虑对上述算法进行优化 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<ul>
<li>
<p>我们可以只考虑 <span class="markdown-them-math-inline">$\mu$</span> 值不等于 <span class="markdown-them-math-inline">$0$</span> 的因数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</li>
<li>
<p>考虑预处理出小于 <span class="markdown-them-math-inline">$\sqrt{maxa}$</span> 的所有因数的前缀和<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>这样对于这些因数的询问是 <span class="markdown-them-math-inline">$\Theta(1)$</span> 的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</li>
<li>
<p>考虑我们相当于要求 <span class="markdown-them-math-inline">$q$</span> 个询问不大于 <span class="markdown-them-math-inline">$x$</span> 的为某个数的倍数的方案数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>先将这些点排个序<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>然后就可以直接 <span class="markdown-them-math-inline">$\rm two~pointers$</span> 求<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>时间复杂度可以降到 <span class="markdown-them-math-inline">$\Theta(n\sigma(maxa))$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</li>
</ul>
<p>三者实现其一即可通过本题<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$f(n)=\sum_{d|n}g(d)\iff g(n)=\sum_{d|n}\mu(d)f\left(\frac{n}{d}\right)
$$</div><p><span class="markdown-them-math-inline">$\large\rm Proof:$</span></p>
<div class="markdown-them-math-block">$$\because f=g\times I
$$</div><div class="markdown-them-math-block">$$\therefore f\times \mu=g\times I \times \mu
$$</div><div class="markdown-them-math-block">$$\therefore f\times \mu=g\times \varepsilon = g
$$</div><p><strong>我们来看看这个式子有什么应用<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></strong></p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2522"><strong><span class="markdown-them-math-inline">$\rm [HAOI2011]Problem~B$</span> :</strong></a> 给出 <span class="markdown-them-math-inline">$n$</span> 个询问<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>每个询问给定 <span class="markdown-them-math-inline">$5$</span> 个整数 <span class="markdown-them-math-inline">$a,b,c,d,k$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>求 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\sum_{i=a}^{b}\sum_{j=c}^d[\gcd(i,j)=k]
$$</div><p>保证 <span class="markdown-them-math-inline">$n,a,b,c,d,k\leqslant 5\times 10^4$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>根据容斥原理, 原式可以分成 <span class="markdown-them-math-inline">$4$</span> 块来处理<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>每一块的式子都形如 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\sum_{i=1}^{n} \sum_{j=1}^{m}[\operatorname{gcd}(i, j)=k]
$$</div><p>考虑化简该式子 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\sum_{i=1}^{\left\lfloor\frac{n}{k}\right\rfloor} \sum_{j=1}^{\left\lfloor\frac{m}{k}\right\rfloor}[\operatorname{gcd}(i, j)=1]
$$</div><p>因为 <span class="markdown-them-math-inline">$\operatorname{gcd}(i, j)=1$</span> 时对答案才有贡献<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>于是我们可以将其替换为 <span class="markdown-them-math-inline">$\varepsilon(\operatorname{gcd}(i, j))$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>故原式化为 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\sum_{i=1}^{\left\lfloor\frac{n}{k}\right\rfloor} \sum_{j=1}^{\left\lfloor\frac{m}{k}\right\rfloor} \varepsilon(\operatorname{gcd}(i, j))
$$</div><p>将 <span class="markdown-them-math-inline">$\varepsilon$</span> 函数展开得到 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\sum_{i=1}^{\left\lfloor\frac{n}{k}\right\rfloor} \sum_{j=1}^{\left\lfloor\frac{m}{k}\right\rfloor} \sum_{d \mid \operatorname{gcd}(i, j)} \mu(d)
$$</div><p>变换求和顺序, 先枚举 <span class="markdown-them-math-inline">$d \mid \operatorname{gcd}(i, j)$</span> 可得 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\sum_{d=1}^{\min \left(\left\lfloor\frac{n}{k}\right\rfloor,\left\lfloor\frac{m}{k}\right\rfloor\right)} \mu(d) \sum_{i=1}^{\left\lfloor\frac{n}{k}\right\rfloor}[d \mid i] \sum_{j=1}^{\left\lfloor\frac{m}{k}\right\rfloor}[d \mid j]
$$</div><p>易知 <span class="markdown-them-math-inline">$1 \sim\left\lfloor\frac{n}{k}\right\rfloor$</span> 中 <span class="markdown-them-math-inline">$d$</span> 的倍数有 <span class="markdown-them-math-inline">$\left\lfloor\frac{n}{k d}\right\rfloor$</span> 个, 故原式化为 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$\sum_{d=1}^{\min \left(\left\lfloor\frac{n}{k}\right\rfloor,\left\lfloor\frac{m}{k}\right\rfloor\right)} \mu(d)\left\lfloor\frac{n}{k d}\right\rfloor\left\lfloor\frac{m}{k d}\right\rfloor
$$</div><p>很显然<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>式子可以数论分块求解<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>时间复杂度 <span class="markdown-them-math-inline">$\Theta(W+n\sqrt{W})$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h3 id="莫比乌斯反演的非卷积形式">莫比乌斯反演的非卷积形式</h3>
<p>对于数论函数 <span class="markdown-them-math-inline">$f,g$</span> 和完全积性函数 <span class="markdown-them-math-inline">$t$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>满足 <span class="markdown-them-math-inline">$t(1)=1$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>有 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$f(n)=\sum_{i=1}^nt(i)g\left(\left\lfloor\frac{n}{i}\right\rfloor\right)\\ \iff g(n)=\sum_{i=1}^n\mu(i)t(i)f\left(\left\lfloor\frac{n}{i}\right\rfloor\right)
$$</div><p><span class="markdown-them-math-inline">$\large\rm Proof:$</span></p>
<div class="markdown-them-math-block">$$\begin{aligned} g(n)&amp;=\sum_{i=1}^n\mu(i)t(i)f\left(\left\lfloor\frac{n}{i}\right\rfloor\right)\\ &amp;=\sum_{i=1}^n\mu(i)t(i) \sum_{j=1}^{\left\lfloor\frac{n}{i}\right\rfloor}t(j) g\left(\left\lfloor\frac{\left\lfloor\frac{n}{i}\right\rfloor}{j}\right\rfloor\right)\\ &amp;=\sum_{i=1}^n\mu(i)t(i) \sum_{j=1}^{\left\lfloor\frac{n}{i}\right\rfloor}t(j) g\left(\left\lfloor\frac{n}{ij}\right\rfloor\right)\\ &amp;=\sum_{T=1}^n \sum_{i=1}^n\mu(i)t(i) \sum_{j=1}^{\left\lfloor\frac{n}{i}\right\rfloor}[ij=T] t(j)g\left(\left\lfloor\frac{n}{T}\right\rfloor\right) &amp;\\ &amp;=\sum_{T=1}^n \sum_{i \mid T}\mu(i)t(i) t\left(\frac{T}{i}\right)g\left(\left\lfloor\frac{n}{T}\right\rfloor\right) \\ &amp;=\sum_{T=1}^ng\left(\left\lfloor\frac{n}{T}\right\rfloor\right) \sum_{i \mid T}\mu(i)t(i)t\left(\frac{T}{i}\right)\\ &amp;=\sum_{T=1}^ng\left(\left\lfloor\frac{n}{T}\right\rfloor\right) \sum_{i \mid T}\mu(i)t(T)\\ &amp;=\sum_{T=1}^ng\left(\left\lfloor\frac{n}{T}\right\rfloor\right)t(T) \sum_{i \mid T}\mu(i)\\ &amp;=\sum_{T=1}^ng\left(\left\lfloor\frac{n}{T}\right\rfloor\right)t(T) \varepsilon(T) &amp;\\ &amp;=g(n)t(1) &amp;\\ &amp;=g(n) &amp; \end{aligned}
$$</div>
      
    </div>
    <footer class="article-footer">
      
      
        <a href="#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="" itemprop="commentCount"></span>
          留言
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Gcd-Lcm-%E5%8F%8D%E6%BC%94/" rel="tag">Gcd-Lcm 反演</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Min-Max-%E5%8F%8D%E6%BC%94/" rel="tag">Min-Max 反演</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/OI/" rel="tag">OI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/%E4%BA%8C%E9%A1%B9%E5%BC%8F%E5%8F%8D%E6%BC%94/" rel="tag">二项式反演</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/%E6%96%AF%E7%89%B9%E6%9E%97%E5%8F%8D%E6%BC%94/" rel="tag">斯特林反演</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/" rel="tag">组合数学</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%8F%8D%E6%BC%94/" rel="tag">莫比乌斯反演</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../sheng-cheng-han-shu/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          生成函数
        
      </div>
    </a>
  
  
    <a href="../du-jiao-shai/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          杜教筛
        
      </div>
    </a>
  
</nav>

  
</article>



  <section id="comments" class="vcomment">

  </section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="../../../../tags/2-SAT/" style="font-size: 10px;">2-SAT</a> <a href="../../../../tags/37-%E6%B3%95%E5%88%99/" style="font-size: 10px;">37% 法则</a> <a href="../../../../tags/ABC/" style="font-size: 13.33px;">ABC</a> <a href="../../../../tags/AC-%E8%87%AA%E5%8A%A8%E6%9C%BA/" style="font-size: 10px;">AC 自动机</a> <a href="../../../../tags/AI/" style="font-size: 10px;">AI</a> <a href="../../../../tags/AI-inference/" style="font-size: 10px;">AI inference</a> <a href="../../../../tags/AtCoder/" style="font-size: 14.17px;">AtCoder</a> <a href="../../../../tags/Boruvka/" style="font-size: 10px;">Boruvka</a> <a href="../../../../tags/C-%E8%AF%AD%E8%A8%80/" style="font-size: 10px;">C 语言</a> <a href="../../../../tags/C/" style="font-size: 18.33px;">C++</a> <a href="../../../../tags/Codechef/" style="font-size: 10px;">Codechef</a> <a href="../../../../tags/Codeforces/" style="font-size: 10.83px;">Codeforces</a> <a href="../../../../tags/FFT/" style="font-size: 10px;">FFT</a> <a href="../../../../tags/FWT/" style="font-size: 10px;">FWT</a> <a href="../../../../tags/Gcd-Lcm-%E5%8F%8D%E6%BC%94/" style="font-size: 10px;">Gcd-Lcm 反演</a> <a href="../../../../tags/Johnson-%E9%87%8D%E8%B5%8B%E6%9D%83/" style="font-size: 10px;">Johnson 重赋权</a> <a href="../../../../tags/KMP/" style="font-size: 10px;">KMP</a> <a href="../../../../tags/KMP-%E8%87%AA%E5%8A%A8%E6%9C%BA/" style="font-size: 10px;">KMP 自动机</a> <a href="../../../../tags/Kruskal/" style="font-size: 10px;">Kruskal</a> <a href="../../../../tags/Kruskal-%E9%87%8D%E6%9E%84%E6%A0%91/" style="font-size: 10px;">Kruskal 重构树</a> <a href="../../../../tags/LCA/" style="font-size: 10px;">LCA</a> <a href="../../../../tags/Manacher/" style="font-size: 10px;">Manacher</a> <a href="../../../../tags/Min-Max-%E5%8F%8D%E6%BC%94/" style="font-size: 10px;">Min-Max 反演</a> <a href="../../../../tags/Motif/" style="font-size: 10px;">Motif</a> <a href="../../../../tags/NTT/" style="font-size: 10.83px;">NTT</a> <a href="../../../../tags/OI/" style="font-size: 20px;">OI</a> <a href="../../../../tags/Prim/" style="font-size: 10px;">Prim</a> <a href="../../../../tags/Project-Euler/" style="font-size: 10px;">Project Euler</a> <a href="../../../../tags/Prufer-%E5%BA%8F%E5%88%97/" style="font-size: 10px;">Prufer 序列</a> <a href="../../../../tags/Python/" style="font-size: 12.5px;">Python</a> <a href="../../../../tags/RMQ/" style="font-size: 10px;">RMQ</a> <a href="../../../../tags/Tarjan/" style="font-size: 10.83px;">Tarjan</a> <a href="../../../../tags/Trie/" style="font-size: 10px;">Trie</a> <a href="../../../../tags/Ucup/" style="font-size: 10.83px;">Ucup</a> <a href="../../../../tags/XCPC/" style="font-size: 10.83px;">XCPC</a> <a href="../../../../tags/Z-%E7%AE%97%E6%B3%95/" style="font-size: 10px;">Z 算法</a> <a href="../../../../tags/%E4%B8%AD%E5%9B%BD%E8%BF%91%E4%BB%A3%E5%8F%B2%E7%BA%B2%E8%A6%81/" style="font-size: 10px;">中国近代史纲要</a> <a href="../../../../tags/%E4%B8%BB%E5%AE%9A%E7%90%86/" style="font-size: 10px;">主定理</a> <a href="../../../../tags/%E4%BA%8C%E5%88%86%E9%98%9F%E5%88%97/" style="font-size: 10px;">二分队列</a> <a href="../../../../tags/%E4%BA%8C%E9%A1%B9%E5%BC%8F%E5%8F%8D%E6%BC%94/" style="font-size: 10px;">二项式反演</a> <a href="../../../../tags/%E4%BC%A0%E9%80%92%E9%97%AD%E5%8C%85/" style="font-size: 10px;">传递闭包</a> <a href="../../../../tags/%E5%86%B3%E7%AD%96%E5%8D%95%E8%B0%83%E6%80%A7/" style="font-size: 10px;">决策单调性</a> <a href="../../../../tags/%E5%87%BD%E6%95%B0/" style="font-size: 10px;">函数</a> <a href="../../../../tags/%E5%88%86%E5%9D%97/" style="font-size: 10.83px;">分块</a> <a href="../../../../tags/%E5%88%86%E6%9E%90/" style="font-size: 11.67px;">分析</a> <a href="../../../../tags/%E5%88%9D%E7%AD%89%E6%95%B0%E5%AD%A6/" style="font-size: 10px;">初等数学</a> <a href="../../../../tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" style="font-size: 11.67px;">动态规划</a> <a href="../../../../tags/%E5%8D%A1%E7%89%B9%E5%85%B0%E6%95%B0/" style="font-size: 10px;">卡特兰数</a> <a href="../../../../tags/%E5%8E%9F%E6%A0%B9/" style="font-size: 10px;">原根</a> <a href="../../../../tags/%E5%8F%8D%E6%82%94%E8%B4%AA%E5%BF%83/" style="font-size: 10px;">反悔贪心</a> <a href="../../../../tags/%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96-Trie-%E6%A0%91/" style="font-size: 10px;">可持久化 Trie 树</a> <a href="../../../../tags/%E5%90%91%E9%87%8F/" style="font-size: 10px;">向量</a> <a href="../../../../tags/%E5%9B%9B%E8%BE%B9%E5%BD%A2%E4%B8%8D%E7%AD%89%E5%BC%8F/" style="font-size: 10px;">四边形不等式</a> <a href="../../../../tags/%E5%9B%BE%E8%AE%A1%E6%95%B0/" style="font-size: 10px;">图计数</a> <a href="../../../../tags/%E5%9B%BE%E8%AE%BA/" style="font-size: 15.83px;">图论</a> <a href="../../../../tags/%E5%9D%90%E6%A0%87%E7%B3%BB/" style="font-size: 10px;">坐标系</a> <a href="../../../../tags/%E5%A4%8D%E6%9D%82%E5%BA%A6/" style="font-size: 10.83px;">复杂度</a> <a href="../../../../tags/%E5%A4%9A%E9%87%8D%E7%A7%AF%E5%88%86/" style="font-size: 10px;">多重积分</a> <a href="../../../../tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F/" style="font-size: 10px;">多项式</a> <a href="../../../../tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E5%88%86%E6%B2%BB%E4%B9%98%E6%B3%95/" style="font-size: 10px;">多项式分治乘法</a> <a href="../../../../tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/" style="font-size: 10px;">多项式基本操作</a> <a href="../../../../tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size: 13.33px;">字符串</a> <a href="../../../../tags/%E5%B7%A5%E5%85%B7%E6%96%87/" style="font-size: 10px;">工具文</a> <a href="../../../../tags/%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F/" style="font-size: 10px;">差分约束</a> <a href="../../../../tags/%E5%B9%B3%E9%9D%A2%E5%9B%BE%E6%9C%80%E5%B0%8F%E5%89%B2%E8%BD%AC%E5%AF%B9%E5%81%B6%E5%9B%BE%E6%9C%80%E7%9F%AD%E8%B7%AF/" style="font-size: 10px;">平面图最小割转对偶图最短路</a> <a href="../../../../tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/" style="font-size: 10px;">并查集</a> <a href="../../../../tags/%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/" style="font-size: 10px;">强连通分量</a> <a href="../../../../tags/%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B/" style="font-size: 10px;">微分方程</a> <a href="../../../../tags/%E5%BE%AE%E7%A7%AF%E5%88%86/" style="font-size: 10px;">微积分</a> <a href="../../../../tags/%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5%E6%8F%92%E5%80%BC/" style="font-size: 10px;">拉格朗日插值</a> <a href="../../../../tags/%E6%8C%87%E6%95%B0%E5%9E%8B%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0/" style="font-size: 10px;">指数型生成函数</a> <a href="../../../../tags/%E6%95%A3%E6%96%87/" style="font-size: 10px;">散文</a> <a href="../../../../tags/%E6%95%B0%E5%88%97/" style="font-size: 10px;">数列</a> <a href="../../../../tags/%E6%95%B0%E5%AD%A6/" style="font-size: 16.67px;">数学</a> <a href="../../../../tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 12.5px;">数据结构</a> <a href="../../../../tags/%E6%95%B0%E8%AE%BA/" style="font-size: 13.33px;">数论</a> <a href="../../../../tags/%E6%95%B4%E9%99%A4%E6%80%A7%E6%A3%80%E9%AA%8C/" style="font-size: 10px;">整除性检验</a> <a href="../../../../tags/%E6%96%87%E5%8C%96%E8%AF%BE/" style="font-size: 10px;">文化课</a> <a href="../../../../tags/%E6%96%87%E7%AB%A0/" style="font-size: 15.83px;">文章</a> <a href="../../../../tags/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/" style="font-size: 10px;">斐波那契数列</a> <a href="../../../../tags/%E6%96%9C%E7%8E%87%E4%BC%98%E5%8C%96/" style="font-size: 10px;">斜率优化</a> <a href="../../../../tags/%E6%96%AF%E7%89%B9%E6%9E%97%E5%8F%8D%E6%BC%94/" style="font-size: 10px;">斯特林反演</a> <a href="../../../../tags/%E6%96%B0%E7%9A%84%E6%80%9D%E8%80%83/" style="font-size: 10.83px;">新的思考</a> <a href="../../../../tags/%E6%96%B9%E7%A8%8B/" style="font-size: 10.83px;">方程</a> <a href="../../../../tags/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/" style="font-size: 10px;">最小生成树</a> <a href="../../../../tags/%E6%9C%80%E7%9F%AD%E8%B7%AF/" style="font-size: 10.83px;">最短路</a> <a href="../../../../tags/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%9B%BE/" style="font-size: 10px;">最短路图</a> <a href="../../../../tags/%E6%9C%9F%E6%9C%9B/" style="font-size: 10px;">期望</a> <a href="../../../../tags/%E6%9D%9C%E6%95%99%E7%AD%9B/" style="font-size: 10px;">杜教筛</a> <a href="../../../../tags/%E6%A0%91%E4%B8%8A%E8%83%8C%E5%8C%85/" style="font-size: 10px;">树上背包</a> <a href="../../../../tags/%E6%A0%91%E5%88%86%E6%B2%BB/" style="font-size: 10px;">树分治</a> <a href="../../../../tags/%E6%A6%82%E7%8E%87%E4%B8%8E%E6%9C%9F%E6%9C%9B/" style="font-size: 10.83px;">概率与期望</a> <a href="../../../../tags/%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0/" style="font-size: 10.83px;">欧拉函数</a> <a href="../../../../tags/%E6%AC%A7%E6%8B%89%E5%8F%98%E6%8D%A2/" style="font-size: 10px;">欧拉变换</a> <a href="../../../../tags/%E6%AC%A7%E6%8B%89%E5%9B%9E%E8%B7%AF/" style="font-size: 10px;">欧拉回路</a> <a href="../../../../tags/%E7%82%B9%E5%8F%8C%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/" style="font-size: 10px;">点双连通分量</a> <a href="../../../../tags/%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0/" style="font-size: 10.83px;">生成函数</a> <a href="../../../../tags/%E7%9C%81%E9%98%9F%E9%80%89%E6%8B%94/" style="font-size: 11.67px;">省队选拔</a> <a href="../../../../tags/%E7%A7%91%E7%A0%94/" style="font-size: 10.83px;">科研</a> <a href="../../../../tags/%E7%A7%AF%E5%88%86/" style="font-size: 10px;">积分</a> <a href="../../../../tags/%E7%A7%AF%E6%80%A7%E5%87%BD%E6%95%B0/" style="font-size: 10px;">积性函数</a> <a href="../../../../tags/%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">笔记</a> <a href="../../../../tags/%E7%AE%97%E6%B3%95/" style="font-size: 19.17px;">算法</a> <a href="../../../../tags/%E7%B1%BB%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95/" style="font-size: 10px;">类欧几里得算法</a> <a href="../../../../tags/%E7%BA%BF%E6%80%A7%E5%90%8C%E4%BD%99%E6%96%B9%E7%A8%8B/" style="font-size: 10px;">线性同余方程</a> <a href="../../../../tags/%E7%BA%BF%E6%80%A7%E7%AD%9B/" style="font-size: 10px;">线性筛</a> <a href="../../../../tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" style="font-size: 10.83px;">线段树</a> <a href="../../../../tags/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/" style="font-size: 15px;">组合数学</a> <a href="../../../../tags/%E7%BB%BC%E8%BF%B0/" style="font-size: 10px;">综述</a> <a href="../../../../tags/%E7%BC%A9%E7%82%B9/" style="font-size: 10px;">缩点</a> <a href="../../../../tags/%E8%80%83%E9%A2%98/" style="font-size: 10px;">考题</a> <a href="../../../../tags/%E8%83%8C%E5%8C%85/" style="font-size: 10px;">背包</a> <a href="../../../../tags/%E8%87%AA%E7%84%B6%E5%B8%B8%E6%95%B0/" style="font-size: 10px;">自然常数</a> <a href="../../../../tags/%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%87%BD%E6%95%B0/" style="font-size: 10px;">莫比乌斯函数</a> <a href="../../../../tags/%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%8F%8D%E6%BC%94/" style="font-size: 10px;">莫比乌斯反演</a> <a href="../../../../tags/%E8%99%9A%E6%A0%91/" style="font-size: 10px;">虚树</a> <a href="../../../../tags/%E8%A3%B4%E8%9C%80%E5%AE%9A%E7%90%86/" style="font-size: 10px;">裴蜀定理</a> <a href="../../../../tags/%E8%AE%A1%E6%95%B0/" style="font-size: 10px;">计数</a> <a href="../../../../tags/%E8%AF%84%E8%AE%BA/" style="font-size: 10.83px;">评论</a> <a href="../../../../tags/%E8%AF%97%E6%AD%8C/" style="font-size: 12.5px;">诗歌</a> <a href="../../../../tags/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%AE%9A%E7%90%86/" style="font-size: 10px;">贝叶斯定理</a> <a href="../../../../tags/%E8%B4%AA%E5%BF%83/" style="font-size: 10px;">贪心</a> <a href="../../../../tags/%E8%B6%A3%E9%A2%98/" style="font-size: 10.83px;">趣题</a> <a href="../../../../tags/%E8%BE%B9%E5%8F%8C%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/" style="font-size: 10px;">边双连通分量</a> <a href="../../../../tags/%E8%BF%9E%E9%80%9A%E6%80%A7/" style="font-size: 10.83px;">连通性</a> <a href="../../../../tags/%E9%83%A8%E5%88%86%E5%88%86%E5%BC%8F%E5%AE%9A%E7%90%86/" style="font-size: 10px;">部分分式定理</a> <a href="../../../../tags/%E9%93%BE%E5%89%96%E5%88%86/" style="font-size: 10px;">链剖分</a> <a href="../../../../tags/%E9%95%BF%E9%93%BE%E5%89%96%E5%88%86/" style="font-size: 10px;">长链剖分</a> <a href="../../../../tags/%E9%98%B6/" style="font-size: 10px;">阶</a> <a href="../../../../tags/%E9%9A%8F%E7%AC%94/" style="font-size: 10.83px;">随笔</a> <a href="../../../../tags/%E9%A2%98%E8%A7%A3/" style="font-size: 17.5px;">题解</a> <a href="../../../../tags/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6/" style="font-size: 10px;">高等数学</a> <a href="../../../../tags/%E9%AB%98%E8%80%83/" style="font-size: 10.83px;">高考</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%95%B0%E5%AD%A6/">数学</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%95%B0%E5%AD%A6/%E5%87%A0%E4%BD%95/">几何</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%95%B0%E5%AD%A6/%E5%88%86%E6%9E%90/">分析</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%95%B0%E5%AD%A6/%E6%95%B0%E8%AE%BA/">数论</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%95%B0%E5%AD%A6/%E6%A6%82%E7%8E%87%E4%B8%8E%E6%9C%9F%E6%9C%9B/">概率与期望</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%95%B0%E5%AD%A6/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/">组合数学</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%96%87%E7%AB%A0/">文章</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%96%87%E7%AB%A0/%E5%B7%A5%E5%85%B7%E6%96%87/">工具文</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%96%87%E7%AB%A0/%E6%95%A3%E6%96%87/">散文</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%96%87%E7%AB%A0/%E8%AF%84%E8%AE%BA/">评论</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%96%87%E7%AB%A0/%E8%AF%97%E6%AD%8C/">诗歌</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%96%87%E7%AB%A0/%E9%9A%8F%E7%AC%94/">随笔</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%A7%91%E7%A0%94/">科研</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%A7%91%E7%A0%94/AI/">AI</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%A7%91%E7%A0%94/AI/AI-inference/">AI inference</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%A7%91%E7%A0%94/%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95/">推荐算法</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/">算法</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/">动态规划</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%86%B3%E7%AD%96%E5%8D%95%E8%B0%83%E6%80%A7/">决策单调性</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E6%A0%91%E4%B8%8A%E8%83%8C%E5%8C%85/">树上背包</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E8%83%8C%E5%8C%85/">背包</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/">图论</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/2-SAT/">2-SAT</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/Prufer-%E5%BA%8F%E5%88%97/">Prufer 序列</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F/">差分约束</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/">最小生成树</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/%E6%9C%80%E7%9F%AD%E8%B7%AF/">最短路</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/%E6%AC%A7%E6%8B%89%E5%9B%9E%E8%B7%AF/">欧拉回路</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/%E8%99%9A%E6%A0%91/">虚树</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/%E8%BF%9E%E9%80%9A%E6%80%A7/">连通性</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/%E9%93%BE%E5%89%96%E5%88%86/">链剖分</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%AD%97%E7%AC%A6%E4%B8%B2/">字符串</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%AD%97%E7%AC%A6%E4%B8%B2/AC-%E8%87%AA%E5%8A%A8%E6%9C%BA/">AC 自动机</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%AD%97%E7%AC%A6%E4%B8%B2/KMP/">KMP</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%AD%97%E7%AC%A6%E4%B8%B2/Manacher/">Manacher</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%AD%97%E7%AC%A6%E4%B8%B2/Trie/">Trie</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E5%AD%97%E7%AC%A6%E4%B8%B2/Z-%E7%AE%97%E6%B3%95/">Z 算法</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%88%86%E5%9D%97/">分块</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%B9%B6%E6%9F%A5%E9%9B%86/">并查集</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E6%95%B0%E8%AE%BA/">数论</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E6%95%B0%E8%AE%BA/%E6%9D%9C%E6%95%99%E7%AD%9B/">杜教筛</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E6%95%B0%E8%AE%BA/%E7%B1%BB%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95/">类欧几里得算法</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E6%95%B0%E8%AE%BA/%E7%BA%BF%E6%80%A7%E7%AD%9B/">线性筛</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/">组合数学</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/%E5%A4%9A%E9%A1%B9%E5%BC%8F/">多项式</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%AE%97%E6%B3%95/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0/">生成函数</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E9%A2%98%E8%A7%A3/">题解</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E9%A2%98%E8%A7%A3/AtCoder/">AtCoder</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E9%A2%98%E8%A7%A3/AtCoder/ABC/">ABC</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E9%A2%98%E8%A7%A3/Codechef/">Codechef</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E9%A2%98%E8%A7%A3/Codeforces/">Codeforces</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E9%A2%98%E8%A7%A3/Project-Euler/">Project Euler</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E9%A2%98%E8%A7%A3/Ucup/">Ucup</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E9%A2%98%E8%A7%A3/%E6%95%B0%E5%AD%A6/">数学</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E9%A2%98%E8%A7%A3/%E8%B6%A3%E9%A2%98/">趣题</a></li></ul></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
        <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a><br /><a rel="license" href="https://101001011.github.io/">本网站</a>所有内容采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可。
      
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="../../../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../../../archives" class="mobile-nav-link">Archives</a>
  
    <a href="../../../../about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="../../../../js/clipboard.min.js"></script>
<script src="../../../../js/jquery-1.4.3.min.js"></script>

<script src="../../../../fancybox/jquery.fancybox-1.3.4.pack.js"></script>


<script src="../../../../js/script.js"></script>




  
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

<script>
    var GUEST_INFO = ['nick','mail','link'];
    var guest_info = 'nick, mail, link'.split(',').filter(function(item){
        return GUEST_INFO.indexOf(item) > -1
    });
    var notify = 'false' == true;
    var verify = 'false' == true;
    new Valine({
        el: '.vcomment',
        notify: notify,
        verify: verify,
        appId: "1Q3xPv5JaTwf1i8Osv9PE0kD-gzGzoHsz",
        appKey: "uudKdohpIaxALz5jZjexXhcb",
        placeholder: "留下你精妙的 idea 吧!",
        pageSize:'10',
        avatar:'mp',
        lang:'zh-cn'
    });
</script>



<script>
  MathJax = {
    options: {
      enableMenu: false
    },
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
    }
  };
</script>
<!-- <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
    CommonHTML: {
      linebreaks: false
    }
  });
  </script> -->
<script type="text/javascript" id="MathJax-script" async
  src="../../../../mathjax/tex-chtml.js">
</script>
<!-- <script type="text/javascript"
   src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS_CHTML">
</script> -->

  </div>
</body>
</html>